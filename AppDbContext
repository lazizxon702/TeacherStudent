using Microsoft.EntityFrameworkCore;
using StudentTeacher.Student;
using StudentTeacher.Teacher;

namespace StudentTeacher.others;

public class AppDbContext : DbContext
{
    public DbSet<Student.Student> Students { get; set; }
    public DbSet<Teacher.Teacher> Teachers { get; set; }
    public DbSet<StudentsSubjects> StudentsSubjects { get; set; }
    public DbSet<Subject> Subjects { get; set; }

    public AppDbContext() { }

    public AppDbContext(DbContextOptions<AppDbContext> options) : base(options) { }

    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
    {
        if (!optionsBuilder.IsConfigured)
        {
            optionsBuilder.UseNpgsql("Host=localhost;Port=5432;Database=demondb;Username=postgres;Password=1234");
        }
    }

    protected override void OnModelCreating(ModelBuilder modelBuilder)
    {
        base.OnModelCreating(modelBuilder);

        modelBuilder.Entity<Student.Student>().HasData(
            new Student.Student { Id = 1, Name = "Ali Valiyev", CityId = 1, DateOfBirth = new DateTime(2009, 1, 11), Gender = "Erkak", GradeLevel = 11, DepartmentId = 1, CreatedDate = DateTime.UtcNow },
            new Student.Student { Id = 2, Name = "Malika Karimova", CityId = 2, DateOfBirth = new DateTime(2008, 6, 15), Gender = "Ayol", GradeLevel = 11, DepartmentId = 2, CreatedDate = DateTime.UtcNow }
        );

        modelBuilder.Entity<Teacher.Teacher>().HasData(
            new Teacher.Teacher { Id = 1, Name = "Olimov Doston", CityId = 1, DateOfBirth = new DateTime(1985, 3, 12), Gender = "Erkak", Subject = "Math", CreatedDate = DateTime.UtcNow, LastUpdatedDate = DateTime.UtcNow },
            new Teacher.Teacher { Id = 2, Name = "Mahmudova Nodira", CityId = 2, DateOfBirth = new DateTime(1990, 7, 22), Gender = "Ayol", Subject = "Physics", CreatedDate = DateTime.UtcNow, LastUpdatedDate = DateTime.UtcNow }
        );

        modelBuilder.Entity<StudentsSubjects>().HasData(
            new StudentsSubjects { Id = 1, StudentId = 1, SubjectId = 1, Mark = 87, CreatedDate = DateTime.UtcNow, IsDeleted = false },
            new StudentsSubjects { Id = 2, StudentId = 2, SubjectId = 2, Mark = 91, CreatedDate = DateTime.UtcNow, IsDeleted = false }
        );

        modelBuilder.Entity<Subject>().HasData(
            new Subject { Id = 1, Name = "Ona tili", GradeLevel = 11, CreatedDate = DateTime.UtcNow },
            new Subject { Id = 2, Name = "Adabiyot", GradeLevel = 11, CreatedDate = DateTime.UtcNow }
        );
    }
}
